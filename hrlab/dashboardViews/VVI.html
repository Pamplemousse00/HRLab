<!DOCTYPE html>
<html>
  <head>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bulma@0.9.1/css/bulma.min.css">
    <script src="../auth.js"></script>
  </head>
  <body>
    <section class="section">
      <div class="container" style="max-width: 800px;">
        <div class="field">
          <label class="label">Lower Rate Limit</label>
          <input class="input is-danger" type="text" placeholder="Lower Rate Limit..." id="VVIlowerRateLimit">
        </div>
        <div class="field">
          <label class="label">Upper Rate Limit</label>
          <input class="input is-danger" type="text" placeholder="Upper Rate Limit..." id="VVIupperRateLimit">
        </div>
        <div class="field">
          <label class="label">Ventricular Amplitude</label>
          <input class="input is-danger" type="text" placeholder="Ventricular Amplitude..." id="VVIvenAmplitude">
        </div>
        <div class="field">
          <label class="label">Ventricular Pulse Width</label>
          <input class="input is-danger" type="text" placeholder="Ventricular Pulse Width..." id="VVIvenPulseWidth">
        </div>
        <div class="field">
          <label class="label">VRP</label>
          <input class="input is-danger" type="text" placeholder="VRP..." id="VVIVRP">
        </div>
        <div class="field">
          <label class="checkbox">
            <input type="checkbox" class="is-danger" onclick="checkPacing()" id="VVIhysteresisPacingRateBox">
            Hysteresis Pacing
          </label>
        </div>
        <div class="field" hidden id="VVIhysteresisPacingRateField">
          <label class="label">Hysteresis Pacing Rate</label>
          <input class="input is-danger" type="text" placeholder="Hysteresis Pacing Rate..." id="VVIhysteresisPacingRate">
        </div>
        <button class="button is-danger is-fullwidth" onclick="verifyForm()">Save</button>
      </div>
    </section>
  </body>
</html>

<script>
  getData();

  function verifyForm() {

    var flag = false;

    if (document.getElementById('VVIlowerRateLimit').value >= 30 && document.getElementById('VVIlowerRateLimit').value <= 175) {
      if (document.getElementById('VVIupperRateLimit').value >= 50 && document.getElementById('VVIupperRateLimit').value <= 175) {
        if (document.getElementById('VVIvenAmplitude').value >= 0.5 && document.getElementById('VVIvenAmplitude').value <= 5) {
          if (document.getElementById('VVIvenPulseWidth').value >= 0.5 && document.getElementById('VVIvenPulseWidth').value <= 5) {
            if (document.getElementById('VVIhysteresisPacingRateBox').checked) {
              if (document.getElementById('VVIhysteresisPacingRate').value >= 30 && document.getElementById('VVIhysteresisPacingRate').value <= 175) {
                flag = true
              }
            }
            if (document.getElementById('VVIVRP').value >= 150 && document.getElementById('VVIVRP').value <= 500) {
              flag = true;
            }
          }
        }
      }
    }

    if (flag) {
      saveData()
    } else {
      alert('Values are not acceptable');
    }
  }

  function checkPacing() {
    var field = document.getElementById('VVIhysteresisPacingRateField');
    if (field.hidden == false) {
      field.hidden = true;
    } else {
      field.hidden = false;
    }
  }


  function getData() {
    // run on init, prefills textboxes with data from user's storage
    var user = getCurrentUser();
    user.VVI.lowerRateLimit != undefined ? document.getElementById('VVIlowerRateLimit').value = user.VVI.lowerRateLimit : null;
    user.VVI.upperRateLimit != undefined ? document.getElementById('VVIupperRateLimit').value = user.VVI.upperRateLimit : null;
    user.VVI.venAmplitude != undefined ? document.getElementById('VVIvenAmplitude').value = user.VVI.venAmplitude : null;
    user.VVI.venPulseWidth != undefined ? document.getElementById('VVIvenPulseWidth').value = user.VVI.venPulseWidth : null;
    user.VVI.vrp != undefined ? document.getElementById('VVIVRP').value = user.VVI.vrp : null;
    user.VVI.hysteresisPacingBox != undefined ? document.getElementById('VVIhysteresisPacingRateBox').checked = user.VVI.hysteresisPacingBox : null;
    if (user.VVI.hysteresisPacingBox == true) {
      document.getElementById('VVIhysteresisPacingRateField').hidden = false;
    }
    user.VVI.hysteresisPacing != undefined ? document.getElementById('VVIhysteresisPacingRate').value = user.VVI.hysteresisPacing : null;
  }
  function saveData() {

    // get current user, edit it's properties for this specific mode
    var user = getCurrentUser();
    user.VVI.lowerRateLimit = document.getElementById('VVIlowerRateLimit').value;
    user.VVI.upperRateLimit = document.getElementById('VVIupperRateLimit').value;
    user.VVI.venAmplitude = document.getElementById('VVIvenAmplitude').value;
    user.VVI.venPulseWidth = document.getElementById('VVIvenPulseWidth').value;
    user.VVI.hysteresisPacingBox = document.getElementById('VVIhysteresisPacingRateBox').checked;
    user.VVI.hysteresisPacing = document.getElementById('VVIhysteresisPacingRate').value;
    user.VVI.vrp = document.getElementById('VVIVRP').value;

    // save to storage
    updateCurrentUser(user);
  }
</script>
